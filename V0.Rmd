---
title: "EA - Analisis OVNIs"
output: html_notebook
---

```{r setup, include=FALSE} 
knitr::opts_chunk$set(warning = FALSE, message = FALSE) 
```

# Intro

En este projecto usaremos el fichero de datos "scrubbed.csv" obtenido en <https://www.kaggle.com/datasets/NUFORC/ufo-sightings>. Elimininaremos datos de tipo NA y cambiaremos paises vacios (i.e. pais == "") por "*Otros*". Tambien arreglamos el formato de los datos con la libreria *lubridate*. Usamos la libreria *dplyr* para eliminar columnas no necesarias.

```{r}
# Leemos datos de CSV
datos <- read.csv("scrubbed.csv")

# Reemplacamos paises "" por "Otros"
datos$country <- ifelse(datos$country=="","otros",datos$country)

# Formateamos datos
datos$datetime <- as.POSIXct(datos$datetime, format =  "%m/%d/%Y %H:%M")
datos$'duration (seconds)' <- as.integer(datos$'duration..seconds.')
datos$latitude <- as.numeric(datos$latitude)

# Eliminamos datos NA
datos <- na.omit(datos)

library(dplyr)

datos <- datos %>% select(-one_of('duration..seconds.', 'duration..hours.min.', 'date.posted'))
```

Analisando los datos por pais, podemos ver que la mayoria de los OVNIs reportados son en EEUU. Usaremos la libreria *ggplot2* para generar diagrama, y representamos el diagrama de numero de OVNIs por pais

```{r}
by_country <- aggregate(datos$country, by=list(Country = datos$country), FUN=length)

library(ggplot2)

ggplot(by_country, aes(x="", y=by_country$x, fill=by_country$Country)) +
  geom_bar(stat="identity", width=1) +
  coord_polar("y", start=0) +
  xlab("") +
  ylab("") +
  guides(fill = guide_legend(title = "Pais"))
```

Por eso, hemos decidido hacer nuestros analisis sobre datos solamente de EEUU. Tomamos una prueba de tamaño 1000

```{r}
datos_us <- datos[which(datos$country == 'us'),]

datos_us <- datos_us %>% select(-country)

datos_us <- datos_us[sample(nrow(datos_us), 1000), ]
```

# Tema 3 - Estadística Descriptiva y Regresión (Axel)
## Medidas de Posición - Tendencia Central y No Central

Con `summary(datos_us)` podemos ver la media, mediana y percentiles de varios datos, y calculamos la moda de la duracion con la funcion *mode*

```{r}
summary(datos_us)

mode <- function(x) {
  ux <- unique(x)
  ux[which.max(tabulate(match(x, ux)))]
}

mode(datos_us$'duration (seconds)')
```

## Medidas de Dispersión

Sobre la duracion, calculamos:

| Medida | Formula |
|:------|-------:|
| Varianza | var(x) |
| Desviación típica | sd(x) |
| Cuasivarianza | TODO |
| Cuasivarianza típica | TODO |

```{r}
varianza <- var(datos_us$'duration (seconds)')
print(paste("Varianza: ", varianza))

sd <- sd(datos_us$'duration (seconds)')
print(paste("Desviación típica: ", sd))
```

## Medidas de Forma
TODO

# Tema 4 - Probabilidad (Fonsi)

Probabilidad de ser de cada pais en caso de avistar un ovni

```{r}
dat <- read.csv("scrubbed.csv")
dat_country<-aggregate(dat$country, by=list(Country = dat$country), FUN=length)
dat$country <- ifelse(dat$country=="","otros",dat$country)
numAvistamientos<-count(dat)
proobau1<-dat_country[which(dat_country$Country == 'au'),]
proobau2<-dat_country[which(dat_country$Country == 'ca'),]
proobau3<-dat_country[which(dat_country$Country == 'de'),]
proobau4<-dat_country[which(dat_country$Country == 'gb'),]
proobau5<-dat_country[which(dat_country$Country == 'us'),]
proobau6<-dat_country[which(dat_country$Country == ''),]
probbauval1<-(proobau1$x/numAvistamientos)*100
probbauval2<-(proobau2$x/numAvistamientos)*100
probbauval3<-(proobau3$x/numAvistamientos)*100
probbauval4<-(proobau4$x/numAvistamientos)*100
probbauval5<-(proobau5$x/numAvistamientos)*100
probbauval6<-(proobau6$x/numAvistamientos)*100



print(paste("La probabilidad de avistar un ovni en Australia es del: ",probbauval1,"%"))

print(paste("La probabilidad de avistar un ovni en Canadá es del: ",probbauval2,"%"))

print(paste("La probabilidad de avistar un ovni en Alemania es del: ",probbauval3,"%"))

print(paste("La probabilidad de avistar un ovni en Gran Bretaña es del: ",probbauval4,"%"))

print(paste("La probabilidad de avistar un ovni en Estados Unidos es del: ",probbauval5,"%"))

print(paste("La probabilidad de avistar un ovni en otros países es del: ",probbauval6,"%"))
```

Debido a que es  en Estados Unidos donde hay mayor probabilidad de avistar un UFO vamos a calcular las ciudades donde es mas probable lograrlo


```{r}
by_city <- aggregate(datos_us$city, by=list(City = datos_us$city), FUN=length)
mostseek<-by_city[which(by_city$x>4),]

maxcity<-by_city[which(by_city$x == max(by_city$x)),]
print(paste("La ciudad con mayor probabilidad de avistar un ovni es",maxcity$City,"con una probabilidad de un ",(maxcity$x/count(by_city))*100,"%"))


ggplot(mostseek, aes(x="", y=mostseek$x, fill=mostseek$City)) +
  geom_bar(stat="identity", width=1) +
  xlab("") +
  ylab("") +
  guides(fill = guide_legend(title = "Pais" ))

plot(names.arg=mostseek$Country,mostseek$x,type="l",col="blue", xlab = "Ciudades", ylab = "Avistamientos", main = "Número de avistamientos en ciudades") 

anios<- aggregate(datos_us$city, by=list(Date = format(datos_us$datetime,"%Y")), FUN=length)

plot(anios$Date,anios$x,type="l",col="blue", xlab = "Linea temporal", ylab = "Avistamientos", main = "Número de avistamientos por año")
```


# Tema 5 - Variables Aleatorias y Modelos de Probabilidad (Sergio)

# Tema 6 - Muestreo, Estimación Puntual y por Intervalos de Confianza (Iñigo)

Vamos a construir un intervalo de confianza del 95% para la proporción de avistamientos que duran más de 1200s (20min)
```{r}
#datos1200 <- datos[which(datos$"duration (seconds)" > 1200),]
datos_df <- subset(datos_us, "duration (seconds)" > 1200, select = c(state, "duration (seconds)"))
#print(paste(datos_df))
datos_df
```

# Tema 7 - Contrastes de Hipótesis (Nico)
